<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- Add instructor field to existing view -->
        <record model="ir.ui.view" id="crm_lead_inherit">
                <field name="name">CRM TAs</field>
                <field name="model">crm.lead</field>
                <field name="inherit_id" ref="crm.crm_lead_view_form"></field>
                <field name="arch" type="xml">
                    <field name="phone" position="after">
                        <field name="channel_id" string="Canales"/>
                        <field name="media_id" string="Medios"/>
                        <field name="payment_fraction_id" string="Forma de Pago Fracción"/>
                    </field>

                    <field name="stage_id" position="before">
                        <button name="create_helpdesk" string="Nueva Asistencia de Viaje" type="object" attrs="{'invisible':[('type','!=','opportunity')]}"/>
                    </field>

                    <xpath expr="//label[@for='email_from']" position="before">
                        <field name="user" string="Usuario TAS"/>
                    </xpath>
                    <xpath expr="//field[@name='user_id']" position="after">
                        
                        <field name="code_ids" widget="many2many_tags" options="{'no_create_edit': True}" string="Codigo de Descuento" domain="[('name','ilike',partner_seller_code)]"/>
                    </xpath>
                    <xpath expr="//notebook" position="inside">
                        <page id="promociones" string="Promociones">
                            <group>
                                <group>
                                    <field name="plus"/>
                                    <field name="is_covid_bonus"/>
                                    <field name="consulting_appointment"/>
                                </group>
                                <group>
                                    <field name="luggage_plus"/>
                                    <field name="is_covid_year"/>
                                    <field name="is_telemedicine"/>
                                    <field name="is_telemedicine_free"/>
                                </group>
                            </group>
                        </page>
                        <page id="redes" string="Redes">
                            <group>
                                <group>
                                    <field name="plus"/>
                                    <field name="is_covid_bonus"/>
                                </group>
                                <group>
                                    <field name="luggage_plus"/>
                                </group>
                            </group>
                        </page>
                        <page string="Casos" id="helpdesk">
                            <field name="helpdesk_ids" options="{'no_create_edit': True}"/>
                        </page>
                    </xpath>
                    <xpath expr="//form/sheet/notebook" position="before">
                        <notebook>
                            <page id="informacion" string="Información del Viaje">
                                <group>
                                    <group>
                                        <field name="destination_country"/>
                                        <field name="is_usa" groups="sales_team.group_sale_manager"/>
                                        <field name="passenger_number"/>
                                        <field name="plan_id"/>
                                        <field name="no_preexistence"/>
                                    </group>
                                    <group>
                                        <field name="departure_date"/>
                                        <field name="return_date"/>
                                        <field name="initial_price"/>
                                        <field name="price_quote"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>

                        <notebook>
                            <page id="asegurado" string="Asegurado y Pagos">
                                <group>
                                    <group>
                                        <field name="is_insurance"/>
                                        <field name="sales_date"/>
                                        <field name="paypal_reference"/>
                                        <field name="payu_account"/>
                                        <field name="order_payu"/>
                                    </group>
                                    <group>
                                        <field name="payment_id" string="Formas de Pago"/>
                                        <field name="other_payment" string="Formas de Pago"/>
                                        <field name="is_portfolio_recovery"/>
                                        <field name="payment_reference"/>
                                        <field name="invoice"/>
                                        <field name="autorization"/>
                                        <field name="accounting_state"/>
                                        <field name="accounting_novelty"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                        <notebook>
                            <page id="ventas" string="Proceso de Ventas">
                                <group>
                                    <group>
                                        <field name="partner_seller_code" string="Codigo de descuento" />
                                        <field name="code_promotion"/>
                                        <field name="code_discount"/>
                                        <field name="certificate_number"/>
                                        <field name="payment_order"/>
                                    </group>
                                    <group>
                                        <field name="discount_percent"/>
                                        <field name="offer_date"/>
                                        <field name="is_portfolio_recovery"/>
                                        <field name="add_price"/>
                                        <field name="plan_price"/>
                                        <field name="total_price"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                        <notebook>
                            <page id="adicionales" string="Coberturas Adicionales">
                                <group>
                                    <group>
                                        <field name="denial_visa"/>
                                        <field name="luggage"/>
                                        <field name="sport"/>
                                        <field name="pregnancy"/>
                                        <field name="flight_cancellation"/>
                                        <field name="pet"/>
                                        <field name="tech_protection"/>
                                    </group>
                                    <group>
                                        <field name="adisa"/>
                                        <field name="damage_third_party"/>
                                        <field name="flight_delay"/>
                                        <field name="concierge"/>
                                        <field name="frequent_flyer"/>
                                        <field name="psychological_assistance"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </xpath>
                </field>
        </record>

        <!-- Add instructor field to new view -->
        <record model="ir.ui.view" id="crm_res_partner_code">
                <field name="name">CRM RES CODE</field>
                <field name="model">res.partner.code</field>
                <field name="arch" type="xml">
                    <tree editable="top">
                        <field name="name" string="Codigos"/>
                    </tree>
                </field>
        </record>
        <record model="ir.actions.act_window" id="crm_res_partner_code_action">
            <field name="name">Accion</field>
            <field name="res_model">res.partner.code</field>
            <field name="view_mode">tree</field>
        </record>
        <menuitem name="Codigos Descuento" id="crm_res_partner_code_menu" parent="contacts.res_partner_menu_config" action="crm_res_partner_code_action" sequence="2"/>

        <record model="ir.ui.view" id="crm_lead_inherit_tree">
                <field name="name">CRM TAs</field>
                <field name="model">crm.lead</field>
                <field name="inherit_id" ref="crm.crm_case_tree_view_leads"></field>
                <field name="arch" type="xml">
                    <field name="user_id" position="after">
                        <field name="partner_seller_code" optional="hide"/>
                    </field>
                </field>
        </record>
    </data>
</odoo>